(self.webpackChunk_webapp_mobile_app_portal=self.webpackChunk_webapp_mobile_app_portal||[]).push([["3238"],{87576:function(e){e.exports=function(){"use strict";var e="0.2.2",t=function(){return(t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function r(e,t,r,n){return new(r=r||Promise)(function(i,a){function o(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}l((n=n.apply(e,t||[])).next())})}function n(e,t){var r,n,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){var l=[o,s];if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&l[0]?n.return:l[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,l[1])).done)return i;switch(n=0,(l=i?[2&l[0],i.value]:l)[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,n=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],n=0}finally{r=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function i(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,a=r.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(n=a.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o}function o(e,t,r){if(r||2==arguments.length)for(var n,i=0,a=t.length;i<a;i++)!n&&i in t||((n=n||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function s(){return{}}function l(e){return"object"==typeof e&&null!==e}var c=Object.prototype;function u(e){return"function"==typeof e}function d(e,t,r){return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];if(!e)return s;var l=e[t],c=r.apply(void 0,o([l],a(n),!1)),d=c;return u(d)&&(d=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return c.apply(this,e)}),e[t]=d,function(){d===e[t]?e[t]=l:c=l}}}var p=0;function h(){if("object"==typeof window&&l(window))return window}function f(){if("object"==typeof document&&l(document))return document}var m=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=function(e){if(e)return e.__SLARDAR_REGISTRY__||(e.__SLARDAR_REGISTRY__={Slardar:{plugins:[],errors:[],subject:{}}}),e.__SLARDAR_REGISTRY__.Slardar}(h());r&&(r.errors||(r.errors=[]),r.errors.push(e))},v=function(e,t){var r=e&&new e(t);return[function(e,t){r&&e&&r.observe(e,t)},function(){return r&&r.disconnect()}]},_=function(e){var t=e&&e.timing||void 0;return[t,function(){return e&&e.now?e.now():(Date.now?Date.now():+new Date)-(t&&t.navigationStart||0)},function(t){var r=(e||{}).getEntriesByType;return u(r)&&r.call(e,t)||[]},function(){var t=(e||{}).clearResourceTimings;u(t)&&t.call(e)},function(t){var r=(e||{}).getEntriesByName;return u(r)&&r.call(e,t)||[]}]},g=function(e,t,r,n){var i=e&&new e(function(e,i){e.getEntries?e.getEntries().forEach(function(e,r,n){return t(e,r,n,i)}):n&&n(),r&&i.disconnect()});return[function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(!e||!i)return n&&n();try{t.forEach(function(t){-1<e.supportedEntryTypes.indexOf(t)&&i.observe({type:t,buffered:!1})})}catch(e){try{i.observe({entryTypes:t})}catch(e){return n&&n()}}},function(){return i&&i.disconnect()}]},y=(b.prototype.subscribe=function(e){this.observers.push(e)},b.prototype.unsubscribe=function(e){this.observers.filter(function(t){return t!==e})},b.prototype.notify=function(e){this.observers.forEach(function(t){t(e)})},b);function b(){this.observers=[]}function w(e){this.cache=new Map,this.capacity=10,this.capacity=e}function S(e){var t=[];return Array.from(e).forEach(function(e){e instanceof Element&&("img"===e.nodeName.toLocaleLowerCase()?t.push(e):null!=e&&e.querySelectorAll&&(e=e.querySelectorAll("img"),t=t.concat(Array.from(e))))}),t}w.prototype.get=function(e){var t;return this.cache.has(e)?(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t),t):null},w.prototype.put=function(e,t){this.cache.has(e)?this.cache.delete(e):this.cache.size>=this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,t)};var C=function(e){var t=[],r=[];return(e=void 0===e?[]:e).forEach(function(e){t.push.apply(t,o([],a(S(e.addedNodes)),!1)),r.push.apply(r,o([],a(S(e.removedNodes)),!1))}),[t,r]},E="undefined"!=typeof IntersectionObserver,R=(T.prototype.set=function(e){var t;E&&null!=(t=this.intersectionObserver)&&t.observe(e),this.record.set(e,{visible:!1,observer:this.intersectionObserver})},T.prototype.del=function(e){var t;null!=(t=this.record.get(e))&&t.visible||!E||null!=(t=this.intersectionObserver)&&t.unobserve(e),this.record.delete(e)},T.prototype.find=function(e){var r,n,o=null;try{for(var s=i(this.record),l=s.next();!l.done;l=s.next()){var c=a(l.value,2),u=c[0],d=c[1];if(u.currentSrc===e){o=t({target:u},d);break}}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o},T);function T(){var e=this;this.record=new Map,this.intersectionObserver=null,E&&(this.intersectionObserver=new IntersectionObserver(function(r){r.forEach(function(r){var n;(r.isIntersecting||0<r.intersectionRatio)&&((n=e.record.get(r.target))&&e.record.set(r.target,t(t({},n),{visible:!0})),null!=(n=e.intersectionObserver)&&n.unobserve(r.target))})},{rootMargin:"200px"}))}function k(e,t,r){var n=1;return function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var l=e.apply(void 0,o([],a(i),!1)),c=n+=2;return t(c,"string"==typeof i[0]?i[0]:i[0].url),l.then(function(){r(c)},function(){r(c)}),l}}function P(e,t,r){var n=0;return function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];var o=n+=2;return t(o,this._url),d(this,"onreadystatechange",function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return 4===this.readyState&&r(o),e&&e.apply(this,t)}})(),e.apply(this,i)}}function A(s,d,p,m,y,b,S){if(void 0===s&&(s=h()),void 0===d&&(d=f()),void 0===p&&(p=h()&&window.location),void 0===m&&(m=function(){if("function"==typeof XMLHttpRequest&&u(XMLHttpRequest))return XMLHttpRequest}()),void 0===y&&(y=function(){if(h()&&l(window.performance))return window.performance}()),void 0===b&&(b=function(){if(h()&&u(window.MutationObserver))return window.MutationObserver}()),void 0===S&&(S=function(){if(h()&&u(window.PerformanceObserver))return window.PerformanceObserver}()),d&&s&&p)return function(l,u){var p=l.debug,E=l.sample_rate,T=void 0===E?D:E,E=l.ignoreUrls,k=void 0===E?[]:E,P=(U="imageReport",($=void 0!==($=p)&&$)?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return console.log.apply(console,o(["[".concat(U,"] ")],a(e),!1))}:function(){});function A(e){P("\u56FE\u7247\u8D44\u6E90\u4E0A\u62A5",e),u&&u({ev_type:N,payload:e})}P("\u56FE\u7247\u63D2\u4EF6\u5DF2\u6CE8\u518C\uFF0Cversion:",e);var U,$,H,V=a(_(y),2)[1],W=new R,Y=new w(10),l=a(M(),3),K=l[0],J=l[1],X=l[2],Z=a(x(s,m,function(e){return P("before http \u8BF7\u6C42, url:",e),!0},function(e){P("after http \u8BF7\u6C42, url:",e=Z.get(e)),e&&Z.size-1<q&&B.notify({ev_type:I,payload:{url:e,remainConnections:q-(Z.size-1)}})}),1)[0],E=a(v(b,function(e){var e=a(C(e),2),t=e[0],e=e[1];(t.length||e.length)&&P("\u76D1\u542C\u5230DOM\u53D8\u66F4",t,e),t.forEach(function(e){return W.set(e)}),e.forEach(function(e){return W.del(e)})}),2),p=E[0],Q=E[1],l=(p(d,{childList:!0,subtree:!0,characterData:!1,attributes:!1}),a(g(S,function(e){var r,n,i,a,o,s,l,u,d,p,h,f,m,v,_,g,y;"img"!==e.initiatorType&&"css"!==e.initiatorType||null!=(_=function(e){if("[object Array]"!==c.toString.call(e))return null;if(e.length){for(var t=[],r=e.length,n=0;n<r;n++){var i=e[n];"string"==typeof i?t.push(i.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")):i&&i.source&&t.push(i.source)}return RegExp(t.join("|"),"i")}return null}(k))&&_.test(e.name)||(P("\u76D1\u542C\u5230resource",e),y=(_=e.toJSON()).name,g=_.initiatorType,r=_.transferSize,n=_.duration,i=_.encodedBodySize,a=_.decodedBodySize,o=_.redirectStart,s=_.redirectEnd,l=_.serverTiming,u=_.domainLookupStart,d=_.domainLookupEnd,p=_.connectStart,h=_.connectEnd,f=_.secureConnectionStart,m=_.requestStart,v=_.responseStart,_=_.responseEnd,"img"===(g={name:y,source:g,dpr:Math.round(null!=(y=null==window?void 0:window.devicePixelRatio)?y:1),needCompress:!1,needSizeOptim:!1,needFormatOptim:!1,hitLocalCache:0===r||void 0===r&&0===n,hitCdnCache:0<=(l||[]).findIndex(function(e){return"cdn-cache"===e.name&&0<=e.description.toLocaleLowerCase().indexOf("hit")}),size:0!==a?i:0,duration:n,redirect:s-o,dns:d-u,tcp:h-p,ssl:void 0===f||f<=0?0:h-f,request:void 0===m||m<=0?0:v-m,download:void 0===v||v<=0?0:_-v,timingDetail:e.toJSON()}).source&&(P("\u5339\u914D\u5230img",y=W.find(e.name),W.record),y&&(g=t(t({},g),{isLazyLoad:!!y.visible,width:(null==(r=y.target)?void 0:r.naturalWidth)||0,height:(null==(l=y.target)?void 0:l.naturalHeight)||0,viewerWidth:null==(a=y.target)?void 0:a.width,viewerHeight:null==(i=y.target)?void 0:i.height}))),B.notify({ev_type:L,payload:g}))}),2)),E=l[0],ee=l[1],et=function(e,i){return r(void 0,void 0,void 0,function(){var r,a,o,s;return n(this,function(n){switch(n.label){case 0:return(r=Y.get(e))?(P("\u547D\u4E2D\u7F13\u5B58header",e,r),[3,3]):[3,1];case 1:return[4,O(e)];case 2:r=n.sent(),Y.put(e,r),n.label=3;case 3:if(s=(a=r||{}).format,o=a.status,a=a.contentLength,P("response header\uFF1A",s,o),"css"===i.source){if(null==s||!s.startsWith("image/"))return X(e),[2]}else if((null==s||!s.startsWith("image/"))&&400>Number(o))return X(e),[2];return!Number((s=t(t({},i||{}),{format:s&&String(s).startsWith("image/")&&null!=(s=s.split(/[,;]/)[0])?s.slice(6):void 0,status:o})).size)&&400>Number(o)&&0<Number(a)&&(s.size=Number(a)),o=F(s),A(t(t({},s),o)),X(e),[2]}})})};return B.subscribe(function(e){var o,s,l,c,u;if(e.ev_type===L){var d,p=V()-(null==(p=null==(p=e.payload)?void 0:p.timingDetail)?void 0:p.responseEnd);if(P("\u8D44\u6E90\u52A0\u8F7D\u4E8B\u4EF6: ",e.payload.name),P("\u8D44\u6E90\u5B8C\u6210\u52A0\u8F7D\u65F6\u95F4: ",null==(u=null==(u=e.payload)?void 0:u.timingDetail)?void 0:u.responseEnd),P("\u65F6\u95F4\u95F4\u9694: ",p),P("\u662F\u5426\u547D\u4E2D\u672C\u5730\u7F13\u5B58: ",null==(u=e.payload)?void 0:u.hitLocalCache),!(Math.random()<Number(T)))return;if(!G)return void J(e.payload.name,t({},e.payload));d=e.payload,r(void 0,void 0,void 0,function(){var e,r,i,a;return n(this,function(n){switch(n.label){case 0:return(P("\u8FDB\u884C\u4E2D\u7684\u8BF7\u6C42\u6570\uFF1A".concat(Z.size)),0<q-Z.size)?(e=Y.get(d.name))?(P("\u547D\u4E2D\u7F13\u5B58header",d.name,e),[3,3]):[3,1]:[3,4];case 1:return[4,O(d.name)];case 2:e=n.sent(),Y.put(d.name,e),n.label=3;case 3:if(a=(r=e||{}).format,i=r.status,r=r.contentLength,P("response header\uFF1A",a,i),"css"===d.source){if(null==a||!a.startsWith("image/"))return[2]}else if((null==a||!a.startsWith("image/"))&&400>Number(i))return[2];return!Number((a=t(t({},d),{format:a&&String(a).startsWith("image/")&&null!=(a=a.split(/[,;]/)[0])?a.slice(6):void 0,status:i})).size)&&400>Number(i)&&0<Number(r)&&(a.size=Number(r)),i=F(a),A(t(t({},a),i)),[3,5];case 4:J(d.name,t({},d)),n.label=5;case 5:return[2]}})})}if(e.ev_type===I&&G){if(P("http\u8BF7\u6C42\u5B8C\u6210\u4E8B\u4EF6"),e.payload.remainConnections<=0)return;try{for(var h=i(K),f=h.next();!f.done;f=h.next()){var m=a(f.value,2),v=m[0];if(null==(w=m[1])||!w.__lock){J(v,t(t({},w),{__lock:!0})),et(v,w);break}}}catch(e){o={error:e}}finally{try{f&&!f.done&&(s=h.return)&&s.call(h)}finally{if(o)throw o.error}}}if(e.ev_type===j&&e.payload.pageLoad){P("pageload \u4E8B\u4EF6");try{for(var _=i(K),g=_.next();!g.done;g=_.next()){var y=a(g.value,2),b=y[0],w=y[1];if(!(0<q-Z.size))break;null!=w&&w.__lock||(J(b,t(t({},w),{__lock:!0})),et(b,w))}}catch(e){l={error:e}}finally{try{g&&!g.done&&(c=_.return)&&c.call(_)}finally{if(l)throw l.error}}G=!0}}),E(z),H=function(){B.notify({ev_type:j,payload:{pageLoad:!0}})},p=h(),l=f(),p&&l&&("complete"===l.readyState?H():p.addEventListener("load",function(){setTimeout(function(){H()},0)},!1)),[function(){P("\u63D2\u4EF6\u9500\u6BC1"),Q(),ee()}]}}var M=function(){var e=new Map;return[e,function(t,r){return e.set(t,r)},function(t){return e.delete(t)}]},x=function(e,t,r,n){function i(e,t){r&&r(t)&&c(e,t)}function o(e){n&&n(e),u(e)}var s=a(M(),3),l=s[0],c=s[1],u=s[2];return t&&d(t.prototype,"send",P)(i,o),e&&d(e,"fetch",k)(i,o),[l]},O=function(e){return r(void 0,void 0,void 0,function(){var t,r;return n(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,fetch(e,{cache:"force-cache"})];case 1:return r=(t=n.sent()).headers,[2,{status:t.status,format:r.get("content-type")||"",contentLength:Number(r.get("content-length"))||0}];case 2:return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,o(["[SDK]",Date.now(),(""+p++).padStart(8," ")],a(e),!1))}("\u83B7\u53D6header\u5931\u8D25",n.sent()),[2,null];case 3:return[2]}})})},F=function(e){var r={needCompress:!1,needSizeOptim:!1,needFormatOptim:!1};if(!e.size)return r;a=(d=e).width,c=d.height,o=void 0===(o=d.format)?"":o,d=d.size,i=navigator&&navigator.userAgent.toLocaleLowerCase().includes("chrome"),u={},/(jpeg|png|bmp)/.test(o)&&(a&&c?(n=Math.round(Math.max(d-a*c*.2,0)),i?(a=Math.round(Math.max(d-a*c/6,0)),u.needFormatOptim=0<a,u.needFormatOptim&&(u.webpSavings=n,u.avifSavings=a)):(u.needFormatOptim=0<n,u.needFormatOptim&&(u.webpSavings=n))):(u.needFormatOptim=!0,u.webpSavings=Math.round(/png/.test(o)?.26*d:.3*d),i&&(u.avifSavings=Math.round(/png/.test(o)?.408*d:.44*d)))),/gif/.test(o)&&(u.needFormatOptim=!0,u.webpSavings=.65*d,i&&(u.avifSavings=.65*d));var n,i,a,o,s,l,c=u,u=(n=(a=e).width,o=a.height,i=void 0===(i=a.format)?"":i,a=a.size,d={},n&&o&&(/(jpeg|bmp)/.test(i)&&(s=a-n*o*.25,d.needCompress=0<s,d.needCompress&&(d.compressSavings=Math.round(s))),/png/.test(i)&&(s=a-n*o*.24,d.needCompress=0<s,d.needCompress&&(d.compressSavings=Math.round(s)))),d),d=(a=(i=e).width,o=e.height,s=e.viewerWidth,d=e.viewerHeight,l=e.dpr,i=e.size,e={},a&&o&&s&&d&&(e.needSizeOptim=0<(s=1-s*d*l*l/(a*o)),e.needSizeOptim&&(e.resizeSavings=Math.round((1-s)*i))),e);return t(t(t(t({},r),c),u),d)},L="image_resource",I="http_custom",j="pageload",N="image",D=.1,z="resource",q=8,B=new y,G=!1,U={sample_rate:D};return{version:e,imageReport:function(e){return void 0===e&&(e=U),{name:"imageReport",setup:function(t){t.on("init",function(){var r=a(function(e,t,r,n){void 0===t&&(t={}),void 0===n&&(n=[]);try{var i=e.apply(void 0,o([],a(n),!1));return i&&i(t,r)||[]}catch(e){return m(e),[]}}(A,e,t.report.bind(t)),1)[0];t.on("beforeDestroy",function(){r()})})}}}}}()},93782:function(e,t,r){"use strict";r.d(t,{HD:()=>i,Wc:()=>n});let n={row:"https://sf16-website-login.neutral.ttwstatic.com/obj/tiktok_web_login_static/slardar/fe/sdk-web/browser.sg.js",eu:"https://sf16-website-login.neutral.ttwstatic.com/obj/tiktok_web_login_static/slardar/fe/sdk-web/browser.sg.js",us:"https://lf16-cdn-tos.tiktokcdn-us.com/obj/static-tx/slardar/fe/sdk-web/browser.oci.js"},i={row:"https://sf16-website-login.neutral.ttwstatic.com/obj/tiktok_web_login_static/slardar/fe/sdk-web/plugins",eu:"https://sf16-website-login.neutral.ttwstatic.com/obj/tiktok_web_login_static/slardar/fe/sdk-web/plugins",us:"https://lf16-cdn-tos.tiktokcdn-us.com/obj/static-tx/slardar/fe/sdk-web/plugins"}},13567:function(e,t,r){"use strict";let n;r.d(t,{O:()=>eB});var i,a,o,s,l,c,u,d,p,h,f,m,v={};r.r(v),(i=u||(u={})).OnConnect="onConnect",i.OnInit="onInit",i.OnCreate="onCreate",i.OnBeforeInit="onBeforeInit";let _={},g=()=>{};class y{create(e){let t=new y(e),r=this._instance.create(t._prefix);return t._inject(r),t._setConfigInjector(this._configInjector),t._callSyncHook(this._plugins,{prefix:e},u.OnCreate,({returnValue:e})=>{t._plugins.push(e)}),t._callSyncHook(t._plugins,t._extends,u.OnConnect),t}setGlobalSlardarName(e){this._instance.setGlobalSlardarName?.(e)}_inject(e){this._instance=e,this._injected=!0}_setConfigInjector(e){this._configInjector=e}assertInjected(){if(!this._injected)throw Error("[Slardar] instance has not injected into container")}init(e){let t=this._configInjector();this._doInit({...t,...e})}async _doInit(e){if(this._inited)return;this.assertInjected(),this._callSyncHook(this._plugins,e,u.OnBeforeInit);let t=this._instance;t.context(e.context),t.init(e),this._inited=!0,await this._callAsyncHook(this._plugins,e,u.OnInit),e.autoStart&&this.start()}config(e){return this._instance.config(e)}context(e){this._instance.context(e)}start(){this._instance.start()}captureException(e,t,r){this._instance.captureException(e,t,r)}sendEvent(e){this._instance.sendEvent(e)}sendLog(e){this._instance.sendLog(e)}sendCustomPerfMetric(e){this._instance.sendCustomPerfMetric(e)}sendPageview(e){return this._instance.sendPageview?.(e)}on(e,t){this._instance.on(e,t)}rawInstance(){return this._instance.rawInstance()}use(e){this._plugins.push(e),this._callSyncHook([e],this._extends,u.OnConnect)}_callSyncHook(e,t,r,n=g){e.forEach((e,i)=>{let a=e[r];if(a){let r=a.call(e,{data:t,container:this});n({plugin:e,index:i,returnValue:r})}})}_callAsyncHook(e,t,r){let n=[];return e.forEach(e=>{let i=e[r];if(i){let r=i.call(e,{data:t,container:this});r&&"then"in r&&n.push(r)}}),Promise.all(n).catch(e=>console.error(e))}reportActualFMP(){let e=this.ttap.reportActualFMP?.();return this.sparkTracing?.reportActualFMP(),e??0}reportActualLCP(){throw Error("not implement")}reportCustomRequest(e,t,r){throw Error("not implement")}getContainerInitTotalTime(){throw Error("not implement")}reportFirstScreenRequest(e,t){throw Error("not implement")}reportRenderStart(){throw Error("not implement")}reportRenderEnd(){throw Error("not implement")}reportRouteRenderStart(){throw Error("not implement")}reportRouteRenderEnd(){throw Error("not implement")}reportPageReady(){throw Error("not implement")}reportStabilityEvent(e){throw Error("not implement")}reportStabilityStack(e){throw Error("not implement")}reportPageCrash(e){throw Error("not implement")}reportJsError(e){throw Error("not implement")}constructor(e="global"){this._instance=_,this._injected=!1,this._plugins=[],this._configInjector=()=>null,this._inited=!1,this._extends=(e,t)=>{this[e]=t},this.ttap={},this._prefix=e}}let b={};function w(e){return window[e]}class S{setGlobalSlardarName(e){this._globalSlardarName=e,this._onSlardarLoaded()}_onSlardarLoaded(){if(!this._createNew)return;let{loaded:e,initPromise:t,instanceGetter:r}=function(e){let t=b[e]||function(e){let t="function"==typeof window[e].create,r=t?Promise.resolve(!0):new Promise(r=>{window[e]("on","init",()=>{t=!0,r(!0)})});return{slardarName:e,loaded:t,initPromise:r,instanceGetter:w.bind(null,e)}}(e);return b[e]=t,t}(this._globalSlardarName);if(e){let e=r().create();this._instanceGetter=()=>e;return}let n=function(){let e=[],t=function(...r){t.mock?e.push(r):(Object.setPrototypeOf(t,t.slardar),t.slardar(...r))};return t.flush=function(r){e.forEach(e=>{r.apply(r,e)}),t.mock=!1,t.slardar=r},t.mock=!0,t}();this._instanceGetter=()=>n,t.then(()=>{let e=r().create();this._instanceGetter().flush(e),this._instanceGetter=()=>e}).catch(()=>{})}get _instance(){return this._instanceGetter()}rawInstance(){return this._instance}init(e){return this._instance("init",e)}config(e){return this._instance("config",e)}start(){return this._instance("start")}context(e){if(!e)return;let t=this._instance,r=0;if(Object.keys(e).forEach(n=>{void 0===e[n]||null===e[n]?t("context.delete",n):(t("context.set",n,e[n]),r++)}),r>40)return void setTimeout(()=>{let e=Error(`Exceed slardar context maximum count 40. The number of your slardar context is ${r}, slardar will drop all your events.`);throw console.error(e),e},20)}sendPageview(e){return this._instance("sendPageview",e)}captureException(e,t,r){this._instance("captureException",e,t,r)}sendEvent(e){this._instance("sendEvent",e)}sendLog(e){this._instance("sendLog",e)}sendCustomPerfMetric(e){this._instance("sendCustomPerfMetric",e)}on(e,t){return this._instance("on",e,t)}create(e=""){let t=new S(e);return t.setGlobalSlardarName(this._globalSlardarName),t}constructor(e=""){this._globalSlardarName="SlardarWeb",this._instanceGetter=()=>window[this._globalSlardarName],this._createNew=!!e}}(a=d||(d={})).TLB_ERROR="tlb error",a.AG_BLOCK="ag block",a.BIZ_CODE_NOT_ZERO="biz code not zero",a.RISK_CONTROL=" risk control",(o=p||(p={}))[o.OK=200]="OK",o[o.AG_BLOCK=403]="AG_BLOCK",(s=h||(h={})).BIZ_STATUS_CODE="biz_status_code",s.BIZ_CODE_HEADER="biz_code_header",s.SYSTEM_ERROR_HEADER="system_error_header",s.STABILITY_ABNORMAL_TYPE="stability_abnormal_type",s.HAS_VERIFY_HEADER="has_verify_header",(l=f||(f={})).CONTENT_TYPE="content-type",l.BIZ_CODE_HEADER="bd-tt-error-code",l.SYSTEM_ERROR="x-tt-system-error",l.RISK_CONTROL="bdturing-verify";let C=[/mcs.*\.tiktok[vw]?\.(com|us|eu)/,"mon.tiktokv.(com|us|eu)"],E=[40001,40002,40003,40004,40005,40006,40007,40008,40009,5e4,50001,50002,50003,6e4],R=["chrome-extension://","moz-extension://","safari-extension://","safari-web-extension://"],T=e=>null==e||"null"===e||""===e||'""'===e,k=e=>{let{bizStatusCode:t,bizCodeHeader:r,systemErrorHeader:n,resBody:i,httpStatus:a,hasVerifyHeader:o,isApi:s}=e;return n?"tlb error":403===a&&void 0!==t&&E.includes(Number(t))?"ag block":o||s&&[200,403].includes(a)&&T(i)?" risk control":(void 0===t||[0,"0"].includes(t))&&(""===r||[0,"0"].includes(r))?void 0:"biz code not zero"},P=(e,t,r,n,i)=>{let a,o=r.response.headers?.["bd-tt-error-code"]??"",s=r.response.headers?.["x-tt-system-error"]??"",l=!!r.response.headers?.["bdturing-verify"],c=!!r.response.headers?.["content-type"]?.includes("application/json"),u=r.response.status;try{let e="string"==typeof t?JSON.parse(t):t;a=i&&!T(t)?i(t,r.request.url):void 0;let n=a?.code??e?.status_code??e?.statusCode??e?.code??e?.status,d=k({resBody:t,bizCodeHeader:o,bizStatusCode:n,systemErrorHeader:s,httpStatus:u,url:r.request.url,hasVerifyHeader:l,isApi:c});r.extra={biz_status_code:void 0===n?"undefined":String(n),...l?{has_verify_header:String(l)}:{},...o?{biz_code_header:String(o)}:{},...s?{system_error_header:String(s)}:{},...d?{stability_abnormal_type:String(d)}:{}}}catch{let e=k({resBody:t,bizCodeHeader:o,httpStatus:u,systemErrorHeader:s,hasVerifyHeader:l,isApi:c});r.extra={...l?{has_verify_header:String(l)}:{},...e?{stability_abnormal_type:String(e)}:{},...o?{biz_code_header:String(o)}:{},...s?{system_error_header:String(s)}:{}}}if(e){let i=Object.values(h);r.extra=new Proxy(r.extra,{set(e,t,r){if(i.includes(t))throw Error(`[solution-slardar-reliability]: extra field '${t}' is frozen, you can report by other field name.`);return e[t]=r,!0}});let a=new Proxy(r,{set(e,t,r){if("extra"===t)throw Error('[solution-slardar-reliability]: cannot assign payload.extra, you can report extra filed like "payload.extra.{fieldName} = {fieldVal}"');return e[t]=r,!0}});try{let r=e(t,a,n);"[object Object]"===Object.prototype.toString.call(r)&&console.error('[solution-slardar-reliability]: return object is forbidden because it will delete the default reliability fields. You can report extra filed like "payload.extra.{fieldName} = {fieldVal}" and return false')}catch(e){console.error(e)}r.extra=a.extra}return!!a?.isError&&!!r.extra&&r.extra},A=(e,t)=>{if(void 0===e)return t;let r=[...e],n=e.map(e=>e.toString());return t.forEach(e=>{n.includes(e.toString())||r.push(e)}),r};function M(e){return new Promise(t=>setTimeout(t,e))}function x(){return/(iPhone|iPad|iPod)/i.test(window.navigator.userAgent)}function O(){var e;return(null==(e=null==performance?void 0:performance.timing)?void 0:e.navigationStart)||(null==performance?void 0:performance.timeOrigin)}function F(){var e;let t=window.performance&&window.performance.getEntriesByType&&window.performance.getEntriesByType("navigation")[0];if(t&&(e=t).responseStart>0&&e.responseStart<window.performance.now())return t}class L{constructor(){this.isResolved=!1,this.isRejected=!1,this.promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}resolve(e){this.isResolved||this.isRejected||(this._resolve(e),this.resolvedValue=e,this.isResolved=!0)}reject(e){this.isResolved||this.isRejected||(this._reject(e),this.error=e,this.isRejected=!0)}reset(){this.resolvedValue=void 0,this.isResolved=!1,this.promise=new Promise(e=>{this._resolve=e})}}function I(e,t){var r,n;return"undefined"!=typeof window&&(null==(n=null==(r=window.__VOM_GLOBAL_TIMING_STORE_KEY)?void 0:r[e])?void 0:n[t])||0}class j extends Error{constructor(){super("detect cancel")}}class N{constructor(e,{registerTimeout:t=300,detectTimeout:r=3e4,isSpa:n=!0}={}){this._deferred=new L,this._teardownList=[],this._onReportActualFMP=e,this._options={isSpa:n,registerTimeout:t,detectTimeout:r}}async preRegister(e){let t=e=>{if(e instanceof j)return void console.debug("detect canceled");console.error("error",e)};this._options.isSpa&&e.slardar.on("beforeConfig",r=>{let n=performance.now();r.pid&&r.pid!==e.slardar.getState().pid&&(this._deferred.reject(new j),this._deferred=new L,this._deferred.promise.then(t=>{let{fmp:r,elements:i}=t,a=(r<n?performance.now():r)-n;e.slardar.callClient("sendCustomPerfMetric",{name:"ttap_spa_load",value:a}),console.debug("ttap_spa_load",a,null==i?void 0:i[0])}).catch(t).finally(()=>{this._teardown()}),setTimeout(()=>{this._detect()}))});let r=this._deferred.promise.then(e=>{let{fmp:t,elements:r}=e;this._onReportActualFMP(t,r),console.debug("fmp",t,null==r?void 0:r[0])}).catch(t).finally(()=>{this._teardown()});if(this._detect(!0))return r}_detect(e=!1){try{let t=Array.from(document.body.querySelectorAll("[data-fmp]"));if(t.length>0){let{completedImages:r,incompleteImages:n,others:i}=this._classify(t);if(i.length>0){if(e)return this._setTimeout(this._options.registerTimeout),this._detectFCP(i),!0;return this._deferred.resolve({fmp:performance.now(),elements:i}),!1}if(r.length>0){if(e)return this._setTimeout(this._options.registerTimeout),this._detectResponseEndTime(r),!0;return this._deferred.resolve({fmp:performance.now(),elements:r.map(e=>e.element)}),!1}if(n.length>0)return this._setTimeout(this._options.detectTimeout),this._detectLoadedTime(n),!1}let r=new MutationObserver(e=>{let t=e.flatMap(e=>"attributes"===e.type?"data-fmp"===e.attributeName&&"string"==typeof e.target.getAttribute("data-fmp")?[e.target]:[]:Array.from(e.addedNodes).flatMap(e=>e instanceof Element?e.getAttribute("data-fmp")?[e]:Array.from(e.querySelectorAll("[data-fmp]")):[])),{completedImages:r,incompleteImages:n,others:i}=this._classify(Array.from(t));return i.length>0?void this._deferred.resolve({fmp:performance.now(),elements:i}):r.length>0?void this._deferred.resolve({fmp:performance.now(),elements:r.map(e=>e.element)}):n.length>0?void this._detectLoadedTime(n):void 0});r.observe(document.body,{childList:!0,subtree:!0,attributeFilter:["data-fmp"]}),this._teardownList.push(()=>{r.disconnect()}),this._setTimeout(this._options.detectTimeout)}catch(e){this._deferred.reject(e)}return!1}async postRegister(){}_teardown(){try{this._teardownList.forEach(e=>e()),this._teardownList=[]}catch(e){console.error("teardown error",e)}}_classify(e){let t=[],r=[],n=[];return e.forEach(e=>{var i,a;if("IMG"===e.tagName&&(e.src||(null!=(a=null==(i=e.srcset)?void 0:i.length)?a:0)>0))return e.complete?void t.push({image:e,element:e}):void r.push({image:e,element:e});if("VIDEO"===e.tagName&&e.poster){let n=new Image;return(n.src=e.poster,n.complete)?void t.push({image:n,element:e}):void r.push({image:n,element:e})}n.push(e)}),{completedImages:t,incompleteImages:r,others:n}}_detectFCP(e){console.debug("detectFCP");let t=new PerformanceObserver(t=>{let r=t.getEntriesByName("first-contentful-paint")[0];r&&this._deferred.resolve({fmp:r.startTime,elements:e})});t.observe({type:"paint",buffered:!0}),this._teardownList.push(()=>{t.disconnect()})}_detectResponseEndTime(e){console.debug("detectResponseEndTime",e),Promise.allSettled(e.map(({image:e,element:t})=>new Promise((r,n)=>{if(0===e.naturalWidth||0===e.naturalHeight)return void n(Error("Image is not loaded"));if(e.currentSrc.startsWith("data:"))return void r({fmp:performance.now(),elements:[t]});let i=new PerformanceObserver(n=>{let i=n.getEntriesByName(e.currentSrc)[0];i&&r({fmp:i.responseEnd,elements:[t]})});i.observe({type:"resource",buffered:!0}),this._teardownList.push(()=>{i.disconnect()})}))).then(e=>{if(e.every(e=>"rejected"===e.status))return void this._deferred.reject(Error("All images are not loaded"));this._deferred.resolve(e.filter(e=>"fulfilled"===e.status).reduce((e,t)=>t.value.fmp<e.fmp?t.value:e,{fmp:1/0,elements:[]}))})}_detectLoadedTime(e){console.debug("detectLoadedTime",e),e.forEach(({image:e,element:t})=>{let r=()=>{this._deferred.resolve({fmp:performance.now(),elements:[t]})};e.addEventListener("load",r),this._teardownList.push(()=>{e.removeEventListener("load",r)})})}_setTimeout(e){let t=setTimeout(()=>{this._deferred.reject(Error("Timeout"))},e);this._teardownList.push(()=>{clearTimeout(t)})}}class D{_isAfterActualFmp(e){return void 0!==this._actualFmp&&e>this._actualFmp}async preRegister(e){e.slardar.on("beforeSend",e=>{var t,r,n;if(null!=(n=e.common).context||(n.context={}),void 0===this._actualFmp&&"performance"===e.ev_type&&!0===e.payload.isCustom&&"actual_fmp"===e.payload.name)return this._actualFmp=e.payload.value,e;if("resource"===e.ev_type&&!("resources"in e.payload))return e.common.context[D._ACTUAL_FMP_CONTEXT_KEY]=String(this._isAfterActualFmp(e.payload.responseEnd)),e;if("http"===e.ev_type&&e.payload.response.timing)return e.common.context[D._ACTUAL_FMP_CONTEXT_KEY]=String(this._isAfterActualFmp(e.payload.response.timing.responseEnd)),e;if("custom"===e.ev_type&&"jsb_event"===e.payload.name&&(e.common.context[D._ACTUAL_FMP_CONTEXT_KEY]=String(this._isAfterActualFmp(e.payload.metrics.responseEnd))),"performance_longtask"===e.ev_type){let t=null!=(r=e.payload.longtasks)?r:[];e.common.context[D._ACTUAL_FMP_CONTEXT_KEY]=String(this._isAfterActualFmp(t[0].startTime+t[0].duration))}return e})}async postRegister(){}}D._ACTUAL_FMP_CONTEXT_KEY="ttap_is_actual_fmp_reported",(c=m||(m={})).Js="js",c.Css="css",c.Image="image",c.Font="font",c.Html="html",c.Media="media",c.Other="other";class z{async preRegister(e){e.slardar.on("beforeSend",t=>("performance"===t.ev_type&&!0===t.payload.isCustom&&("container_init_cost"===t.payload.name?this._containerInitTime=t.payload.value:"render_start"===t.payload.name?this._renderStartTime=t.payload.value:"render_end"===t.payload.name?this._renderEndTime=t.payload.value:"route_render_start"===t.payload.name?this._routeRenderStartTime=t.payload.value:"route_render_end"===t.payload.name?this._routeRenderEndTime=t.payload.value:"actual_fmp"===t.payload.name&&(this._actualFMPDuration=t.payload.value,this._sendEvent(e.slardar))),"custom"===t.ev_type&&"event"===t.payload.type&&("ttapplugin_info"===t.payload.name?(this._appParseStartTime=t.payload.metrics.appParseStart,this._vmokReadyToLoadTime=t.payload.metrics.vmokReadyToLoad,this._vmokLoadedTime=t.payload.metrics.vmokLoaded):"ttapplugin_first_screen_request"===t.payload.name?(this._requestStartTime=t.payload.metrics.requestStart,this._requestEndTime=t.payload.metrics.requestEnd):"ttapplugin_inapp_info"===t.payload.name&&(this._containerInitTotalTime=t.payload.metrics.containerInitTotalTime)),t))}async postRegister(){}_sendEvent(e){let t={count:1,ttfb:this._getTTFB(),container_init_cost:this._containerInitTime,container_init_total_time:this._containerInitTotalTime,app_parse_start:this._appParseStartTime,vmok_ready_to_load:this._vmokReadyToLoadTime,vmok_loaded:this._vmokLoadedTime,render_start:this._renderStartTime,render_end:this._renderEndTime,route_render_start:this._routeRenderStartTime,route_render_end:this._routeRenderEndTime,request_start:this._requestStartTime,request_end:this._requestEndTime,actual_fmp:this._actualFMPDuration,...this._getResourceSize()};Promise.resolve().then(()=>e.callClient("sendEvent",{name:z._EVENT_NAME,metrics:Object.fromEntries(Object.entries(t).filter(([,e])=>void 0!==e))}))}_getTTFB(){let e=F();if(e)return e.responseEnd-e.startTime}_getResourceSize(){var e;if(void 0===this._actualFMPDuration)return{};let t=this._actualFMPDuration,r={total_size:0,total_transfer_size:0,js_size:0,css_size:0,image_size:0,font_size:0,html_size:0,media_size:0,other_size:0,not_support_size:0},n=window.performance.getEntriesByType("resource"),i=window.performance.getEntriesByType("navigation");return(null==(e=i[0])?void 0:e.encodedBodySize)&&(r.total_size+=i[0].encodedBodySize,r.total_transfer_size+=i[0].transferSize,r.html_size=i[0].encodedBodySize),n.some(e=>{var n;if(e.responseEnd>t)return!1;let i=function(e){let t=e.match(/\/([^\/?#]+\.[^\/?#.]+)(?:\?.*)?$/);return t?t[1]:null}(e.name);if(null===i)return!1;let a=function(e){for(let[t,r]of Object.entries(q))if(r.test(e))return t;return m.Other}(i);if(a!==m.Other&&(0===e.encodedBodySize||e.encodedBodySize>1e9))return r.not_support_size=1,!0;r.total_size+=e.encodedBodySize,r.total_transfer_size+=e.transferSize;let o=`${a}_size`;return r[o]=(null!=(n=r[o])?n:0)+e.encodedBodySize,!1}),1===r.not_support_size?{not_support_size:1}:r}}z._EVENT_NAME="ttapplugin_effective_open_page";let q={[m.Js]:/\.m?js$/i,[m.Css]:/\.css$/i,[m.Html]:/\.html?$/i,[m.Image]:/\.(jpe?g|png|svg|gif|webp|heif|bmp)$/i,[m.Font]:/\.(otf|ttf|eot|woff2?)$/i,[m.Media]:/\.(mp4|webm|mkv|flv|avi|wmv)$/i},B={containerInitCost:{query:e=>{var t;let r=null==(t=e.templateResData)?void 0:t.container_init_cost;return{isResolved:0===r||!!r,val:r}},value:new L},containerInitTotalTime:{query:e=>{let t=0,r=e.containerInitTime;return r&&(t=O()-parseInt(r)),{isResolved:null!=r,val:t}},value:new L},htmlFromGecko:{query:e=>{var t;let r=null==(t=e.templateResData)?void 0:t.res_from;return{isResolved:!!r,val:{resFrom:r,fromGecko:"gecko"===r?"true":"false"}}},fallback:()=>{var e;let t="serverTiming_unknown",r="unknown";if(!x()){let n=null==(e=null==performance?void 0:performance.getEntriesByType("navigation"))?void 0:e[0];(null==n?void 0:n.serverTiming)&&(t=0===n.serverTiming.length?"serverTiming_true":"serverTiming_false",r=0===n.serverTiming.length?"true":"false")}return{isResolved:!0,val:{resFrom:t,fromGecko:r}}},value:new L},geckoChannelName:{query:e=>{var t;let r=null==(t=e.templateResData)?void 0:t.gecko_channel;return{isResolved:null!=r,val:r}},value:new L},deviceScore:{query:e=>{var t;if(x())return{isResolved:!0,val:void 0};let r=null==(t=e.deviceScore)?void 0:t.overall_score;return{isResolved:null!=r,val:{score:null!=r?r:0,scoreRounded:r?Math.floor(r):0}}},value:new L},networkLevel:{query:e=>{let t=e.networkLevel;return{isResolved:null!=t,val:null!=t?t:void 0}},value:new L},appVersion:{query:e=>{let t=e.appVersion;return{isResolved:null!=t,val:t}},value:new L}};function G(e){var t,r,n;let i;try{let r=null==(t=window.__globalprops)?void 0:t.getGlobalProps();if(!(i=JSON.parse(r)))throw Error("no globalProps");return B[e].query(i)}catch{try{let t=null==(n=(r=B[e]).fallback)?void 0:n.call(r);if(t)return t}catch{}return{isResolved:!0,val:void 0}}}let U={};function $(){for(let e of Object.values(U))e()}async function H(e){if(B[e].value.isResolved)return B[e].value.promise;let t=G(e);if(t.isResolved)B[e].value.resolve(t.val);else{let t=function(e,t){let r=`sub_${t}_${Date.now()}_${Math.floor(1e4*Math.random())}`;return U[r]=e,r}(()=>{let r=G(e);r.isResolved&&(B[e].value.resolve(r.val),t&&delete U[t])},e)}return B[e].value.promise}let V={actualFmp:{},afterVmokResolve:{},onVmokLoad:{}};function W(e,t){V[e]&&"object"==typeof V[e]&&Object.keys(V[e]).forEach(r=>{V[e][r](t)})}function Y(e,t){let r=`sub_${e}_${Date.now()}_${Math.floor(1e4*Math.random())}`;return V[e]&&"object"==typeof V[e]?(V[e][r]=t,{unsubscribe:()=>{delete V[e][r]}}):{unsubscribe:()=>{}}}let K="<overlong>",J=["type","name","title","alt"];function X(e,t,r){let n=Z({performanceMarkPoint:"ActualFMP:end",performanceMeasureName:"ActualFMP",value:t}),{elements:i,attrlist:a}=null!=r?r:{};return e.callClient("sendCustomPerfMetric",{name:"actual_fmp",value:n,extra:{element:i&&i.length>0?function(e,t){try{let r,n=e,i=[],a=0,o=0;for(;n&&a++<5&&(r=function(e,{attrlist:t=J}={}){var r,n;let i,a,o,s,l=[];if(!e||!e.tagName)return"";if(l.push(e.tagName.toLowerCase()),e.id)return`#${e.id}`;let c=e.className;if(c&&"string"==typeof c&&c.length>0)for(s=0,i=c.split(/\s+/);s<i.length;s++)l.push(`.${i[s]}`);for(s=0;s<t.length;s++)a=t[s],(o=e.getAttribute(a))&&l.push(`[${a}="${o}"]`);let u=e,d=1,p=!0;for(;u=u.previousElementSibling;)(null==(r=u.tagName)?void 0:r.toLowerCase())===(null==(n=e.tagName)?void 0:n.toLowerCase())&&(u.className===e.className&&t.every(t=>e.getAttribute(t)===(null==u?void 0:u.getAttribute(t)))&&(p=!1),d++);return d>1&&!p&&l.push(`:nth-of-type(${d})`),l.join("")}(n,t),"html"!==r&&(!(a>1)||!(o+3*i.length+r.length>=256)));)i.push(r.length>=256?K:r),o+=r.length,n=n.parentNode;let s=i.reverse().join(" > ");if(s.length>256)return K;return s}catch(e){return"<unknown>"}}(i[0],{attrlist:a}):"<unknown>"}}),n}function Z(e){var t,r,n,i,a;if(!((null==(n=window.performance)?void 0:n.now)&&(null==(i=window.performance)?void 0:i.mark)&&(null==(a=window.performance)?void 0:a.measure)))return null!=(t=e.value)?t:Date.now()-O();try{if(performance.mark(e.performanceMarkPoint,{startTime:e.value}),e.value)return performance.measure(e.performanceMeasureName,{start:0,end:e.value}).duration;return performance.measure(e.performanceMeasureName,{},e.performanceMarkPoint).duration}catch(t){return console.error(t),null!=(r=e.value)?r:Date.now()-O()}}let Q=null,ee=new Map;function et(e){let t=e?ee.get(e):Q;if(!t)throw Error("Please register the plugin first.");return t}let er=async e=>{try{if(!("undefined"!=typeof window&&e.slardar&&!ee.has(e.slardar)))return Promise.resolve();let{slardar:t,scenario:r}=e,n={register$:new L,slardarClient:t,scenarioInstance:r(t),isAutoDetectFMP:!!e.autoDetectFMP};return ei(e,n.slardarClient,n.scenarioInstance,n.register$),Q||(Q={...n}),ee.set(n.slardarClient,n),n.register$.promise}catch{return Promise.resolve()}};async function en(e,t,r){await e.preRegister(),await Promise.all((null!=t?t:[]).map(e=>e.preRegister({slardar:r})))}async function ei(e,t,r,n){r.setRegisterStart();let i=[new D,new z];e.autoDetectFMP&&i.push(new N((r,n)=>{var i,a,o;let s=et(t);if(!s.slardarClient||!s.scenarioInstance||(null==(a=null==(i=s.slardarClient)?void 0:i.getState())?void 0:a.isSpaRouteCheck))return 0;s.isFirstScreenRequestSent||ea(s.scenarioInstance.getFirstScreenRequests().filter(e=>e.endTime<r+O()),s),s.actualFMPDuration||(s.actualFMPDuration=X(s.slardarClient,r,{elements:n,attrlist:"boolean"==typeof e.autoDetectFMP||null==(o=e.autoDetectFMP)?void 0:o.attrlist}),W("actualFmp",s.actualFMPDuration))},{..."boolean"==typeof e.autoDetectFMP?{}:e.autoDetectFMP,isSpa:e.isSpa}));let a=en(r,[...i,...null!=(o=e.extensions)?o:[]],t);await Promise.race([a,M(300)]),await t.registerClient({disableEnvAutoConfig:e.disableEnvAutoConfig,disableReleaseVersionAutoConfig:e.disableReleaseVersionAutoConfig,env:e.env,release:e.release,isSpa:null!=(s=e.isSpa)&&s,ignoreApiUrl:e.ignoreApiUrl,includeApiUrl:e.includeApiUrl,vmok:e.vmok}),r.setRegisterEnd(),n.resolve(),await M(1);var o,s,l=e.extensions;for(let e of(r.postRegister(),null!=l?l:[]))e.postRegister({slardar:t,subscribeMetric:Y,scenarioState:r.getState()})}function ea(e,t){var r,n;!t.slardarClient||t.isFirstScreenRequestSent||null!=(n=null==(r=t.slardarClient)?void 0:r.getState())&&n.isSpaRouteCheck||0!==e.length&&(!function(e,t){if(0===e.length)return;let r=Math.min(...e.map(e=>e.startTime))-O(),n=Math.max(...e.map(e=>e.endTime))-O();t.callClient("sendEvent",{name:"ttapplugin_first_screen_request",metrics:{requestStart:r,requestEnd:n,duration:n-r}})}(e,t.slardarClient),t.isFirstScreenRequestSent=!0)}let eo=e=>{var t,r;try{let n=et(e);if(!n.slardarClient||!n.scenarioInstance||n.isAutoDetectFMP||(null==(r=null==(t=n.slardarClient)?void 0:t.getState())?void 0:r.isSpaRouteCheck))return 0;if(!n.isFirstScreenRequestSent){let e=n.scenarioInstance.getFirstScreenRequests();ea(e,n)}return n.actualFMPDuration||(n.actualFMPDuration=X(n.slardarClient),W("actualFmp",n.actualFMPDuration)),n.actualFMPDuration}catch{return 0}},es=()=>H("containerInitTotalTime"),el=e=>{var t,r;try{let n=et(e);if(!n.slardarClient||!n.scenarioInstance||(null==(r=null==(t=n.slardarClient)?void 0:t.getState())?void 0:r.isSpaRouteCheck))return 0;return n.renderStartDuration||(n.renderStartDuration=function(e){let t=Z({performanceMarkPoint:"Render:start",performanceMeasureName:"RenderStart"});return e.callClient("sendCustomPerfMetric",{name:"render_start",value:t}),t}(n.slardarClient)),n.renderStartDuration}catch{return 0}},ec=e=>{var t,r;try{let n=et(e);if(!n.slardarClient||!n.scenarioInstance||(null==(r=null==(t=n.slardarClient)?void 0:t.getState())?void 0:r.isSpaRouteCheck))return 0;return n.renderEndDuration||(n.renderEndDuration=function(e){let t=Z({performanceMarkPoint:"Render:end",performanceMeasureName:"RenderEnd"});return e.callClient("sendCustomPerfMetric",{name:"render_end",value:t}),t}(n.slardarClient)),n.renderEndDuration}catch{return 0}},eu=e=>{var t,r;try{let n=et(e);if(!n.slardarClient||!n.scenarioInstance||(null==(r=null==(t=n.slardarClient)?void 0:t.getState())?void 0:r.isSpaRouteCheck))return 0;return n.routeRenderStartDuration||(n.routeRenderStartDuration=function(e){let t=Z({performanceMarkPoint:"RouteRender:start",performanceMeasureName:"RouteRenderStart"});return e.callClient("sendCustomPerfMetric",{name:"route_render_start",value:t}),t}(n.slardarClient)),n.routeRenderStartDuration}catch{return 0}},ed=e=>{var t,r;try{let n=et(e);if(!n.slardarClient||!n.scenarioInstance||(null==(r=null==(t=n.slardarClient)?void 0:t.getState())?void 0:r.isSpaRouteCheck))return 0;return n.routeRenderEndDuration||(n.routeRenderEndDuration=function(e){let t=Z({performanceMarkPoint:"RouteRender:end",performanceMeasureName:"RouteRenderEnd"});return e.callClient("sendCustomPerfMetric",{name:"route_render_end",value:t}),t}(n.slardarClient)),n.routeRenderEndDuration}catch{return 0}},ep=e=>{try{let t=et(e);if(!t.slardarClient||!t.scenarioInstance)return;t.slardarClient.callClient("sendEvent",{name:"page_ready",metrics:{count:1}})}catch{}},eh=(e,t)=>{try{let n=et(t);if(!n.slardarClient||!n.scenarioInstance)return;var r=n.slardarClient;let{cuj:i,isEndStep:a,eventName:o,isSuccess:s,statusCode:l,bizCode:c,api:u,errorMsg:d}=e;o&&void 0!==s&&r.callClient("sendEvent",{name:"biz_common_stability_event",metrics:{count:1},categories:{event_name:o,is_success:String(s),...i?{cuj:i}:{},...l?{status_code:String(l)}:{},...c?{biz_code:String(c)}:{},...u?{api:u}:{},...d?{error_msg:d}:{},...a?{is_end_step:String(a)}:{}}})}catch{}},ef=(e,t)=>{try{let n=et(t);if(!n.slardarClient||!n.scenarioInstance)return;var r=n.slardarClient;let{level:i="info",stack:a,title:o}=e;o&&r.callClient("sendLog",{level:i,content:a,extra:{title:o}})}catch{}},em=(e,t)=>{try{let n=et(t);if(!n.slardarClient||!n.scenarioInstance)return;var r=n.slardarClient;let{errorMsg:i=""}=e;r.callClient("sendEvent",{name:"page_crash",metrics:{count:1},categories:{error_msg:i}})}catch{}},ev=e=>{try{let t={};if(!e.disableReleaseVersionAutoConfig)try{let r=e.release;r||(r=process.env.BUILD_VERSION),r&&(t.release=r)}catch{}if(!e.disableEnvAutoConfig)try{let r=e.env;r||(r=process.env.CUSTOM_BUILD_ENV),r&&(t.env=r)}catch{}if(Object.keys(t).length>0)return t}catch{}};class e_{constructor(e){this._state={bid:void 0,pid:void 0,isSpaRouteCheck:!1,ignoreApiUrl:[/mcs.*\.tiktok[vw]?\.(com|us|eu)/,/mon\.tiktokv\.(com|us|eu)/],includeApiUrl:[],vmok:void 0},this._tempSlardarCalls=[],this._tempSlardarOns=[],this._isReady=!1,this._hasAdditionalContext=!1,this.callClient=(e,t)=>{this._isReady?this._callSlardarWeb(e,t):this._tempSlardarCalls.push({m:e,e:t})},this.on=(e,t)=>{this._isReady?this._onSlardarWeb(e,t):this._tempSlardarOns.push({e,handler:t})},this._flushTempSlardarCalls=()=>{this._tempSlardarCalls.forEach(({m:e,e:t})=>{this.callClient(e,t)}),this._tempSlardarCalls=[]},this._flushTempSlardarOns=()=>{this._tempSlardarOns.forEach(({e,handler:t})=>{this.on(e,t)}),this._tempSlardarOns=[]},this._updateConfigSlardarWeb=e=>{var t;null==(t=this._slardarClientFn())||t("config",e)},this._callSlardarWeb=(e,t)=>{let r=this._slardarClientFn();r&&("report"===e||"sendEvent"===e||"sendCustomPerfMetric"===e?r(e,t):"sendLog"===e&&r(e,t))},this._onSlardarWeb=(e,t)=>{let r=this._slardarClientFn();r&&r("on",e,e=>{try{return t(e)}catch{return e}})},this._slardarClientFn=e}getState(){return this._state}setState(e,t=!1){var r,n;try{let{bid:i,pid:a}=null!=(n=null==(r=this._slardarClientFn())?void 0:r("config"))?n:{};this._state={...this._state,...e,...t?{bid:i,pid:a}:{}}}catch{}}deregisterClient(){this._hasAdditionalContext=!1,this._isReady=!1}start(){var e;null==(e=this._slardarClientFn())||e("start")}registerClient(e){let{includeApiUrl:t,ignoreApiUrl:r,vmok:n,isSpa:i}=e,a={},o=this._slardarClientFn();if(!o)return Promise.resolve(!1);if(t&&Array.isArray(t)&&(a.includeApiUrl=[...t]),r&&Array.isArray(r)&&(a.ignoreApiUrl=Array.isArray(a.ignoreApiUrl)?[...a.ignoreApiUrl,...r]:[...r]),(null==n?void 0:n.name)&&(a.vmok=n),this._hasAdditionalContext&&o("on","start",()=>{var e;try{let t=this._slardarClientFn(),r=null!=(e=null==t?void 0:t.getPreStartQueue())?e:[];r.forEach((e,n)=>{var i,a;r[n]={...e,overrides:{...null!=(i=e.overrides)?i:{},context:(null==(a=null==t?void 0:t.context)?void 0:a.toString())||{}}}})}catch{}}),i)try{let{name:e}=F()||{};if(e){let t=new URL(e),r=new URL(document.URL);a.isSpaRouteCheck=t.pathname!==r.pathname}o("on","beforeConfig",e=>{var t,r;try{let n=null==e?void 0:e.pid,i=null==(r=null==(t=this._slardarClientFn())?void 0:t("config"))?void 0:r.pid;i&&n&&n!==i&&this.setState({isSpaRouteCheck:!0})}catch(e){}}),o("on","config",()=>{try{this.setState({},!0)}catch{}})}catch(e){console.error("ttap plugin error",e)}return new Promise(t=>{o("on","init",()=>{let r=ev(e);r&&this._updateConfigSlardarWeb(r),this._isReady=!0,this._flushTempSlardarOns(),this._flushTempSlardarCalls(),this.setState(a,!0),t(!0)})})}updateContext(e,t){let r=this._slardarClientFn();r&&(r("context.set",e,t),this._hasAdditionalContext=!0)}}let eg=e=>{if(e())return new e_(e)},ey={start:0,end:0};function eb(){ey.start=Date.now()}function ew(){ey.end=Date.now()}function eS(e){let{vmok:t}=e.getState(),r={};if(r.registerDuration=ey.end-ey.start,r.navigationStartTime=O(),window.TTAP_DOMPARSE_STARTTIME&&(r.domParseStart=window.TTAP_DOMPARSE_STARTTIME-r.navigationStartTime),window.TTAP_APPPARSE_STARTTIME&&(r.appParseStart=window.TTAP_APPPARSE_STARTTIME-r.navigationStartTime),t){let e=t.name,n=I(e,"afterResolve"),i=I(e,"onLoad");n&&i&&(r.vmokReadyToLoad=n-r.navigationStartTime,r.vmokLoaded=i-r.navigationStartTime)}let n={},i="1.14.3";i&&(n.version=i),e.callClient("sendEvent",{name:"ttapplugin_info",metrics:r,categories:n})}let eC=[],eE=!1,eR={script:!0,link:!0,img:!0,css:!0},eT={isActualFMPSent:!1},ek=[],eP=e=>{ek.push(e),ek.length>5&&ek.shift()},eA=(e,t,r,n)=>{e.getEntries().forEach(e=>{var i,a;let o=null!=(a=null==(i=e.name)?void 0:i.toLowerCase())?a:"";if(o&&!t[o]&&eR[e.initiatorType]){let i="unknown";r.common.find(e=>o.includes(e))?i="common":r.app.find(e=>o.includes(e))&&(i="app");let a="unknown";e.serverTiming&&(a=0===e.serverTiming.length?"true":"false"),t[o]=!0,"unknown"===i?eT.isActualFMPSent||eP({path:e.name,fromGecko:a}):n({path:e.name,fromGecko:a,isFirstScreen:eT.isActualFMPSent?"false":"true",resourceType:i})}else t[o]||(t[o]=!0)})},eM=async(e,t)=>{try{if(x())return;n=Y("actualFmp",()=>{eT.isActualFMPSent=!0,null==n||n.unsubscribe(),ek.forEach(e=>{t({path:e.path,fromGecko:e.fromGecko,isFirstScreen:"true",resourceType:"unknown"})}),ek=[]});let r={},i={common:["/gando_libs/","/tiktok_fonts/"],app:[]};e&&i.app.push(e);try{let e=process.env.GECKO_PATH_PREFIX;e&&i.app.push(e)}catch{}try{let e="tiktok/webapp/main/mobile/app_portal";e&&i.app.push(e)}catch{}let a=await H("geckoChannelName");a&&i.app.push(a),new PerformanceObserver(e=>eA(e,r,i,t)).observe({type:"resource",buffered:!0})}catch{}},ex=(e,t)=>{H("htmlFromGecko").then(t=>{t&&(e.callClient("sendEvent",{name:"from_gecko",categories:{html:t.fromGecko,resFrom:t.resFrom}}),e.updateContext("htmlResFrom",t.resFrom))}),eM(t.geckoResPath,t=>{e.callClient("sendEvent",{name:"from_gecko",categories:{resource:t.fromGecko,path:t.path,isFirstScreen:t.isFirstScreen,resourceType:t.resourceType}})})},eO=e=>{H("containerInitCost").then(t=>{t&&e.callClient("sendCustomPerfMetric",{name:"container_init_cost",value:t})})},eF=e=>{Promise.all([H("containerInitTotalTime"),H("deviceScore")]).then(([t,r])=>{let n={};t&&(n.containerInitTotalTime=t),r&&(n.deviceScore=r.score),Object.keys(n).length>0&&e.callClient("sendEvent",{name:"ttapplugin_inapp_info",metrics:n})})},eL=async(e,t)=>{if(!e[0])return;for(let r of e)try{!function(e,t){let r={};e.globalConfig({onInvokeStart:e=>{if(!e)return e;let{method:t,params:n}=e;if("sendLogV3"===t)return e;let i=Date.now();return e.ttap_id=`method_${i}_${Math.floor(1e3*Math.random())}`,"fetch"===t||"request"===t?r[e.ttap_id]={request:{method:n.method,url:n.url,timestamp:i},startTimestamp:i}:r[e.ttap_id]={request:void 0,startTimestamp:i},e},onInvokeEnd:e=>{var n,i,a,o;if(!e)return;let{response:s,config:l}=e;if(!l)return;let{method:c,ttap_id:u}=l;if("sendLogV3"===c||!u||!r[u])return;let d=Date.now(),p=Math.round(d-performance.now()),{request:h}=r[u];if(("fetch"===c||"request"===c)&&h){let e=h.timestamp-p,r=d-p,l=r-e,c={is_custom_error:!1,status:null!=(i=null==(n=null==s?void 0:s.data)?void 0:n.httpCode)?i:200,timestamp:d,timing:{name:h.url,startTime:e,requestStart:e,responseStart:r,responseEnd:r,duration:l}},{ignoreApiUrl:u=[],includeApiUrl:f=[]}=null!=(o=null==(a=null==t?void 0:t.getState)?void 0:a.call(t))?o:{};u.length&&u.some(e=>"string"==typeof e?h.url.includes(e):e.test(h.url))||t.callClient("report",{ev_type:"http",payload:{api:"jsbridge",request:h,response:c,duration:l}}),!eE&&(u.length||f.length?f.length?f.some(e=>"string"==typeof e?h.url.includes(e):e.test(h.url))&&eC.push({startTime:h.timestamp,endTime:d}):u.some(e=>"string"==typeof e?h.url.includes(e):e.test(h.url))||eC.push({startTime:h.timestamp,endTime:d}):eC.push({startTime:h.timestamp,endTime:d}))}else t.callClient("sendEvent",{name:"jsb_event",metrics:{duration:d-r[u].startTimestamp,requestStart:r[u].startTimestamp-p,responseEnd:d-p},categories:{jsb_method:c}});delete r[u]}})}(r,t)}catch{}var r=e[0];try{r.on("globalPropsUpdated",$)}catch{}let n=H("appVersion").then(e=>{e&&t.updateContext("app_version",e)}).catch(()=>{}),i=H("deviceScore").then(e=>{e&&t.updateContext("device_score",e.scoreRounded.toString())}).catch(()=>{}),a=H("networkLevel").then(e=>{e&&t.updateContext("network_level",e.toString())}).catch(()=>{});await Promise.all([n,i,a])},eI=(e,t)=>{t.disableGeckoCheck||ex(e,t),eO(e),eF(e),eS(e)},ej=()=>(eE=!0,eC),eN=(e,t={})=>{let r=[];return Array.isArray(e)?r.push(...e):r.push(e),e=>({setRegisterStart:eb,setRegisterEnd:ew,preRegister:async()=>{await eL(r,e)},postRegister:()=>{eI(e,t)},getFirstScreenRequests:ej,getState:()=>({type:"inapp",jsb:r[0]})})},eD=new Map,ez=()=>{let e=e=>{var t,r;try{let{ignoreApiUrl:n=[],includeApiUrl:i=[]}=null!=(r=null==(t=null==e?void 0:e.getState)?void 0:t.call(e))?r:{},a=performance.getEntriesByType("resource").filter(e=>("xmlhttprequest"===e.initiatorType||"fetch"===e.initiatorType)&&(!n.length&&!i.length||(i.length?i.some(t=>"string"==typeof t?e.name.includes(t):t.test(e.name)):!n.some(t=>"string"==typeof t?e.name.includes(t):t.test(e.name))))),o=O();return a.map(e=>({startTime:e.startTime+o,endTime:e.startTime+e.duration+o}))}catch(r){let e=performance.getEntriesByType("resource").filter(e=>"xmlhttprequest"===e.initiatorType||"fetch"===e.initiatorType),t=O();return e.map(e=>({startTime:e.startTime+t,endTime:e.startTime+e.duration+t}))}},t=(e,t)=>{var r;let{isSpaRouteCheck:n}=e.getState(),i=O(),a={duration:I(t,"onLoad")-I(t,"afterResolve")};n||(a.vmokReadyToLoad=I(t,"afterResolve")-i,a.vmokLoaded=I(t,"onLoad")-i),console.debug("ttap_vmok_load",t,a),e.callClient("sendEvent",{name:"ttap_vmok_load",metrics:a,categories:{vmok_name:t,vmok_version:null!=(r=eD.get(t))?r:"unknown"}})};return r=>({setRegisterStart:eb,setRegisterEnd:ew,preRegister:async()=>{r.getState().vmok||Y("onVmokLoad",e=>{t(r,e)})},postRegister:()=>{try{let{isSpaRouteCheck:e,vmok:n}=r.getState();e||eS(r),n&&t(r,n.name)}catch{}},getFirstScreenRequests:()=>e(r),getState:()=>({type:"webapp"})})};class eq{onConnect(e){let t={reportCustomRequest:(e,t,r)=>(function(e,t,r,n){var i,a,o,s,l;try{let c=et(n);if(!c.slardarClient||(null==(a=null==(i=c.slardarClient)?void 0:i.getState())?void 0:a.isSpaRouteCheck))return;o=e,s=t,l=r,c.slardarClient.callClient("sendEvent",{name:"ttapplugin_custom_request",metrics:{requestStart:s-O(),requestEnd:l-O(),duration:l-s},categories:{requestName:o}})}catch{return}})(e,t,r,this.slardarClient),getContainerInitTotalTime:es,reportFirstScreenRequest:(e,t)=>{ea([{startTime:e,endTime:t}],et(this.slardarClient))},reportActualFMP:()=>eo(this.slardarClient),reportActualLCP:()=>eo(this.slardarClient),reportRenderStart:()=>el(this.slardarClient),reportRenderEnd:()=>ec(this.slardarClient),reportRouteRenderStart:()=>eu(this.slardarClient),reportRouteRenderEnd:()=>ed(this.slardarClient),reportPageReady:()=>ep(this.slardarClient),reportStabilityEvent:e=>eh(e,this.slardarClient),reportStabilityStack:e=>ef(e,this.slardarClient),reportPageCrash:e=>em(e,this.slardarClient),reportJsError:e=>(0,v.reportJsError)(e,this.slardarClient)};e.data("ttap",t),e.data("reportActualLCP",t.reportActualFMP),e.data("reportCustomRequest",t.reportCustomRequest),e.data("getContainerInitTotalTime",t.getContainerInitTotalTime),e.data("reportFirstScreenRequest",t.reportFirstScreenRequest),e.data("reportRenderStart",t.reportRenderStart),e.data("reportRenderEnd",t.reportRenderEnd),e.data("reportRouteRenderStart",t.reportRouteRenderStart),e.data("reportRouteRenderEnd",t.reportRouteRenderEnd),e.data("reportPageReady",t.reportPageReady),e.data("reportStabilityEvent",t.reportStabilityEvent),e.data("reportStabilityStack",t.reportStabilityStack),e.data("reportPageCrash",t.reportPageCrash),e.data("reportJsError",t.reportJsError)}onInit({container:e,data:t}){let{ttap:r}=t,n=eg(()=>e.rawInstance());return this.slardarClient=n,er({slardar:n,scenario:r?.jsb?eN(r.jsb):ez(),...r})}onCreate(){return new eq}constructor(){this.name="ttap_plugin",this.slardarClient=void 0}}let eB=new y;eB._inject(new S),eB.use(new eq),eB.use(new class{onBeforeInit({data:e}){void 0===e.plugins&&(e.plugins={});let t=e.plugins.jsError;void 0===t?e.plugins.jsError={ignoreErrors:R}:"boolean"!=typeof t&&(t.ignoreErrors=A(t.ignoreErrors,R)),function(e){let t=e.reliability?.bizCodeHandler;void 0===e.plugins&&(e.plugins={});let r=e.plugins.ajax;if(void 0===r)e.plugins.ajax={extraExtractor:(...e)=>P(void 0,...e,t),ignoreUrls:C};else if("boolean"!=typeof r){let e=r.extraExtractor;r.extraExtractor=function r(n,i,a){return e?.name===r.name?P(void 0,n,i,a,t):P(e,n,i,a,t)},r.ignoreUrls=A(r.ignoreUrls,C)}let n=e.plugins.fetch;if(void 0===n)e.plugins.fetch={extraExtractor:(...e)=>P(void 0,...e,t),ignoreUrls:C};else if("boolean"!=typeof n){let e=n.extraExtractor;n.extraExtractor=function r(n,i,a){return e?.name===r.name?P(void 0,n,i,a,t):P(e,n,i,a,t)},n.ignoreUrls=A(n.ignoreUrls,C)}}(e)}onCreate(){return this}constructor(){this.name="Reliability_ajax_fetch"}})}}]);